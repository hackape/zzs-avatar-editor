(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))r(c);new MutationObserver(c=>{for(const l of c)if(l.type==="childList")for(const s of l.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(c){const l={};return c.integrity&&(l.integrity=c.integrity),c.referrerpolicy&&(l.referrerPolicy=c.referrerpolicy),c.crossorigin==="use-credentials"?l.credentials="include":c.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(c){if(c.ep)return;c.ep=!0;const l=n(c);fetch(c.href,l)}})();function h(){}function we(t){return t&&typeof t=="object"&&typeof t.then=="function"}function _e(t){return t()}function ce(){return Object.create(null)}function I(t){t.forEach(_e)}function $e(t){return typeof t=="function"}function H(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let N;function le(t,e){return N||(N=document.createElement("a")),N.href=e,t===N.href}function Ce(t){return Object.keys(t).length===0}function b(t,e){t.appendChild(e)}function v(t,e,n){t.insertBefore(e,n||null)}function _(t){t.parentNode.removeChild(t)}function J(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function g(t){return document.createElement(t)}function K(t){return document.createTextNode(t)}function L(){return K(" ")}function be(){return K("")}function Q(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function m(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Ee(t){return Array.from(t.childNodes)}function je(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function oe(t,e,n){t.classList[n?"add":"remove"](e)}function Le(t,e,{bubbles:n=!1,cancelable:r=!1}={}){const c=document.createEvent("CustomEvent");return c.initCustomEvent(t,n,r,e),c}let A;function $(t){A=t}function V(){if(!A)throw new Error("Function called outside component initialization");return A}function Oe(t){V().$$.on_mount.push(t)}function Pe(){const t=V();return(e,n,{cancelable:r=!1}={})=>{const c=t.$$.callbacks[e];if(c){const l=Le(e,n,{cancelable:r});return c.slice().forEach(s=>{s.call(t,l)}),!l.defaultPrevented}return!0}}const M=[],z=[],U=[],se=[],Me=Promise.resolve();let F=!1;function Ae(){F||(F=!0,Me.then(W))}function G(t){U.push(t)}const q=new Set;let R=0;function W(){const t=A;do{for(;R<M.length;){const e=M[R];R++,$(e),Ie(e.$$)}for($(null),M.length=0,R=0;z.length;)z.pop()();for(let e=0;e<U.length;e+=1){const n=U[e];q.has(n)||(q.add(n),n())}U.length=0}while(M.length);for(;se.length;)se.pop()();F=!1,q.clear(),$(t)}function Ie(t){if(t.fragment!==null){t.update(),I(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(G)}}const B=new Set;let E;function ve(){E={r:0,c:[],p:E}}function ye(){E.r||I(E.c),E=E.p}function C(t,e){t&&t.i&&(B.delete(t),t.i(e))}function j(t,e,n,r){if(t&&t.o){if(B.has(t))return;B.add(t),E.c.push(()=>{B.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function xe(t,e){const n=e.token={};function r(c,l,s,f){if(e.token!==n)return;e.resolved=f;let o=e.ctx;s!==void 0&&(o=o.slice(),o[s]=f);const i=c&&(e.current=c)(o);let a=!1;e.block&&(e.blocks?e.blocks.forEach((u,p)=>{p!==l&&u&&(ve(),j(u,1,1,()=>{e.blocks[p]===u&&(e.blocks[p]=null)}),ye())}):e.block.d(1),i.c(),C(i,1),i.m(e.mount(),e.anchor),a=!0),e.block=i,e.blocks&&(e.blocks[l]=i),a&&W()}if(we(t)){const c=V();if(t.then(l=>{$(c),r(e.then,1,e.value,l),$(null)},l=>{if($(c),r(e.catch,2,e.error,l),$(null),!e.hasCatch)throw l}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}}function Ne(t,e,n){const r=e.slice(),{resolved:c}=t;t.current===t.then&&(r[t.value]=c),t.current===t.catch&&(r[t.error]=c),t.block.p(r,n)}function ke(t){t&&t.c()}function X(t,e,n,r){const{fragment:c,on_mount:l,on_destroy:s,after_update:f}=t.$$;c&&c.m(e,n),r||G(()=>{const o=l.map(_e).filter($e);s?s.push(...o):I(o),t.$$.on_mount=[]}),f.forEach(G)}function Y(t,e){const n=t.$$;n.fragment!==null&&(I(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Re(t,e){t.$$.dirty[0]===-1&&(M.push(t),Ae(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Z(t,e,n,r,c,l,s,f=[-1]){const o=A;$(t);const i=t.$$={fragment:null,ctx:null,props:l,update:h,not_equal:c,bound:ce(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(o?o.$$.context:[])),callbacks:ce(),dirty:f,skip_bound:!1,root:e.target||o.$$.root};s&&s(i.root);let a=!1;if(i.ctx=n?n(t,e.props||{},(u,p,...d)=>{const y=d.length?d[0]:p;return i.ctx&&c(i.ctx[u],i.ctx[u]=y)&&(!i.skip_bound&&i.bound[u]&&i.bound[u](y),a&&Re(t,u)),p}):[],i.update(),a=!0,I(i.before_update),i.fragment=r?r(i.ctx):!1,e.target){if(e.hydrate){const u=Ee(e.target);i.fragment&&i.fragment.l(u),u.forEach(_)}else i.fragment&&i.fragment.c();e.intro&&C(t.$$.fragment),X(t,e.target,e.anchor,e.customElement),W()}$(o)}class ee{$destroy(){Y(this,1),this.$destroy=h}$on(e,n){const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const c=r.indexOf(n);c!==-1&&r.splice(c,1)}}$set(e){this.$$set&&!Ce(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function ie(t,e,n){const r=t.slice();return r[7]=e[n],r}function ae(t,e,n){const r=t.slice();return r[10]=e[n],r}function ue(t){let e,n,r=t[0].category+"",c,l,s,f,o=t[0].images,i=[];for(let u=0;u<o.length;u+=1)i[u]=fe(ae(t,o,u));let a=t[1].palettes&&de(t);return{c(){e=g("fieldset"),n=g("legend"),c=K(r),l=L(),s=g("div");for(let u=0;u<i.length;u+=1)i[u].c();f=L(),a&&a.c(),m(s,"class","images svelte-1vk5jf9")},m(u,p){v(u,e,p),b(e,n),b(n,c),b(e,l),b(e,s);for(let d=0;d<i.length;d+=1)i[d].m(s,null);b(e,f),a&&a.m(e,null)},p(u,p){if(p&1&&r!==(r=u[0].category+"")&&je(c,r),p&7){o=u[0].images;let d;for(d=0;d<o.length;d+=1){const y=ae(u,o,d);i[d]?i[d].p(y,p):(i[d]=fe(y),i[d].c(),i[d].m(s,null))}for(;d<i.length;d+=1)i[d].d(1);i.length=o.length}u[1].palettes?a?a.p(u,p):(a=de(u),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},d(u){u&&_(e),J(i,u),a&&a.d()}}}function fe(t){let e,n,r,c,l,s;function f(){return t[4](t[10])}return{c(){e=g("div"),n=g("img"),c=L(),le(n.src,r=URL.createObjectURL(t[10].blob))||m(n,"src",r),m(n,"alt",""),m(e,"class","image-select svelte-1vk5jf9"),oe(e,"selected",t[1].image===t[10])},m(o,i){v(o,e,i),b(e,n),b(e,c),l||(s=Q(e,"click",f),l=!0)},p(o,i){t=o,i&1&&!le(n.src,r=URL.createObjectURL(t[10].blob))&&m(n,"src",r),i&3&&oe(e,"selected",t[1].image===t[10])},d(o){o&&_(e),l=!1,s()}}}function de(t){let e,n,r,c=Object.entries(t[1].palettes),l=[];for(let s=0;s<c.length;s+=1)l[s]=pe(ie(t,c,s));return{c(){e=g("div"),e.textContent="Palette:",n=L();for(let s=0;s<l.length;s+=1)l[s].c();r=be()},m(s,f){v(s,e,f),v(s,n,f);for(let o=0;o<l.length;o+=1)l[o].m(s,f);v(s,r,f)},p(s,f){if(f&10){c=Object.entries(s[1].palettes);let o;for(o=0;o<c.length;o+=1){const i=ie(s,c,o);l[o]?l[o].p(i,f):(l[o]=pe(i),l[o].c(),l[o].m(r.parentNode,r))}for(;o<l.length;o+=1)l[o].d(1);l.length=c.length}},d(s){s&&_(e),s&&_(n),J(l,s),s&&_(r)}}}function pe(t){let e,n,r,c;function l(...s){return t[5](t[7],...s)}return{c(){e=g("input"),m(e,"type","color"),e.value=n=t[7][0]},m(s,f){v(s,e,f),r||(c=Q(e,"change",l),r=!0)},p(s,f){t=s,f&2&&n!==(n=t[7][0])&&(e.value=n)},d(s){s&&_(e),r=!1,c()}}}function Ue(t){let e,n=t[0]&&ue(t);return{c(){n&&n.c(),e=be()},m(r,c){n&&n.m(r,c),v(r,e,c)},p(r,[c]){r[0]?n?n.p(r,c):(n=ue(r),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:h,o:h,d(r){n&&n.d(r),r&&_(e)}}}function Be(t){return t.toString(16).padStart(6,"0")}function Se(t){const e=t.png.palettes.map(n=>[`#${Be(n)}`,""]);return Object.fromEntries(e)}function Te(t,e,n){const r=Pe();let{resource:c=null}=e,l={category:"",priority:-1,image:null,palettes:null};Oe(()=>{s(c.images[0])});function s(a){!c||(l.image===a?(n(1,l.image=null,l),n(1,l.palettes=null,l)):(n(1,l.image=a,l),n(1,l.palettes=Se(a),l)),r("updateConfig",{...l}))}function f(a,u){n(1,l.palettes={...l.palettes,[a]:u},l),r("updateConfig",{...l})}const o=a=>s(a),i=(a,u)=>{f(a[0],u.currentTarget.value)};return t.$$set=a=>{"resource"in a&&n(0,c=a.resource)},t.$$.update=()=>{t.$$.dirty&1&&(n(1,l.category=c.category,l),n(1,l.priority=c.priority,l))},[c,l,s,f,o,i]}class De extends ee{constructor(e){super(),Z(this,e,Te,Ue,H,{resource:0})}}function qe(t){const e=PNG.sync.read(t,{filterType:-1}),n=e.data.length/4,r=new Set;for(let c=0;c<n;c++){const l=c*4;if(!e.data[l+3])continue;const f=e.data.readUInt32BE(l);let o=f;f==~~f?o=f>>8:o=(f^2147483648)>>8^8388608,r.add(o)}return e.palettes=Array.from(r),e}async function ze(t){const n=await(await fetch(t)).json();return Promise.all(n.map(async({category:r,priority:c,files:l})=>({category:r,priority:c,images:await Promise.all(l.map(async s=>{const o=await(await fetch(s)).blob(),i=qe(Buffer.from(await o.arrayBuffer()));return{filename:s,blob:o,url:URL.createObjectURL(o),png:i}}))})))}function Fe(...t){let e=[0,0,0,0],n;for(;n=t.shift();)if(e[3]&&n[3]){if(n[3]==255){e=Array.from(n);continue}const r=[0,0,0,0];r[3]=Math.round(n[3]+e[3]-n[3]*e[3]/255),r[0]=Math.round(n[0]*n[3]/r[3]+e[0]*e[3]*(1-n[3]/255)/r[3]),r[1]=Math.round(n[1]*n[3]/r[3]+e[1]*e[3]*(1-n[3]/255)/r[3]),r[2]=Math.round(n[2]*n[3]/r[3]+e[2]*e[3]*(1-n[3]/255)/r[3]),e=r}else e[3]==0&&(e=Array.from(n));return e}function Ge(t){let e,n,r,c,l,s,f,o;return{c(){e=g("div"),n=g("div"),r=g("canvas"),c=L(),l=g("div"),s=g("button"),s.textContent="Save Image",m(r,"id","preview-canvas"),m(r,"height","33"),m(r,"width","33"),m(r,"class","svelte-7kkhdg"),m(n,"class","canvas-container"),m(e,"class","preview svelte-7kkhdg")},m(i,a){v(i,e,a),b(e,n),b(n,r),t[3](r),b(e,c),b(e,l),b(l,s),f||(o=Q(s,"click",t[1]),f=!0)},p:h,i:h,o:h,d(i){i&&_(e),t[3](null),f=!1,o()}}}function he(t){return parseInt(t.slice(1),16)}function He(t){const n=Object.entries(t).filter(r=>r[1]&&r[1]!=r[0]).map(([r,c])=>{const l=he(r),s=he(c),f=(s&16711680)>>16,o=(s&65280)>>8,i=s&255;return[l,[f,o,i]]});return new Map(n)}function Je(t,e,n){let{config:r={}}=e,c;async function l(i){if(!c)return;const a=c.getContext("2d"),u=s(i);!u||a.putImageData(u,0,0)}function s(i){if(!i.length)return null;const a=i[0],{width:u,height:p}=a.image.png,d=new ImageData(u,p),y=i[0].image.png.data.length/4,S=new Map;for(let T=0;T<y;T++){const te=[],k=T*4;for(const O of i){const P=O.image.png.data;if(!S.has(O)){const w=He(O.palettes);S.set(O,w)}if(P[k+3]!=0){const w=[P[k],P[k+1],P[k+2],P[k+3]],ne=(w[0]<<16)+(w[1]<<8)+w[2],re=S.get(O);if(re.has(ne)){const D=re.get(ne);w[0]=D[0],w[1]=D[1],w[2]=D[2]}te.push(w)}}const x=Fe(...te);d.data[k]=x[0],d.data[k+1]=x[1],d.data[k+2]=x[2],d.data[k+3]=x[3]}return d}function f(){const i=document.createElement("a");i.setAttribute("download","Avatar.png"),c.toBlob(a=>{const u=URL.createObjectURL(a);i.setAttribute("href",u),i.click()})}function o(i){z[i?"unshift":"push"](()=>{c=i,n(0,c)})}return t.$$set=i=>{"config"in i&&n(2,r=i.config)},t.$$.update=()=>{if(t.$$.dirty&4){const i=Object.values(r).filter(Boolean);i.sort((a,u)=>a.priority-u.priority),l(i)}},[c,f,r,o]}class Ke extends ee{constructor(e){super(),Z(this,e,Je,Ge,H,{config:2})}}function ge(t,e,n){const r=t.slice();return r[5]=e[n],r}function Qe(t){return{c:h,m:h,p:h,i:h,o:h,d:h}}function Ve(t){let e,n,r,c,l,s;n=new Ke({props:{config:t[0]}});let f=t[4],o=[];for(let a=0;a<f.length;a+=1)o[a]=me(ge(t,f,a));const i=a=>j(o[a],1,1,()=>{o[a]=null});return{c(){e=g("section"),ke(n.$$.fragment),r=L(),c=g("section"),l=g("div");for(let a=0;a<o.length;a+=1)o[a].c();m(e,"class","preview-section"),m(l,"class","container svelte-17lfb7p"),m(c,"class","config-section svelte-17lfb7p")},m(a,u){v(a,e,u),X(n,e,null),v(a,r,u),v(a,c,u),b(c,l);for(let p=0;p<o.length;p+=1)o[p].m(l,null);s=!0},p(a,u){const p={};if(u&1&&(p.config=a[0]),n.$set(p),u&6){f=a[4];let d;for(d=0;d<f.length;d+=1){const y=ge(a,f,d);o[d]?(o[d].p(y,u),C(o[d],1)):(o[d]=me(y),o[d].c(),C(o[d],1),o[d].m(l,null))}for(ve(),d=f.length;d<o.length;d+=1)i(d);ye()}},i(a){if(!s){C(n.$$.fragment,a);for(let u=0;u<f.length;u+=1)C(o[u]);s=!0}},o(a){j(n.$$.fragment,a),o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)j(o[u]);s=!1},d(a){a&&_(e),Y(n),a&&_(r),a&&_(c),J(o,a)}}}function me(t){let e,n;return e=new De({props:{resource:t[5]}}),e.$on("updateConfig",t[3]),{c(){ke(e.$$.fragment)},m(r,c){X(e,r,c),n=!0},p:h,i(r){n||(C(e.$$.fragment,r),n=!0)},o(r){j(e.$$.fragment,r),n=!1},d(r){Y(e,r)}}}function We(t){let e;return{c(){e=g("div"),e.textContent="Loading..."},m(n,r){v(n,e,r)},p:h,i:h,o:h,d(n){n&&_(e)}}}function Xe(t){let e,n,r={ctx:t,current:null,token:null,hasCatch:!1,pending:We,then:Ve,catch:Qe,value:4,blocks:[,,,]};return xe(t[1],r),{c(){e=g("main"),r.block.c(),m(e,"class","svelte-17lfb7p")},m(c,l){v(c,e,l),r.block.m(e,r.anchor=null),r.mount=()=>e,r.anchor=null,n=!0},p(c,[l]){t=c,Ne(r,t,l)},i(c){n||(C(r.block),n=!0)},o(c){for(let l=0;l<3;l+=1){const s=r.blocks[l];j(s)}n=!1},d(c){c&&_(e),r.block.d(),r.token=null,r=null}}}function Ye(t,e,n){const r=ze("/zzs-avatar-editor/parts/manifest.json");let c={};function l(f){f.image?n(0,c[f.category]=f,c):(delete c[f.category],n(0,c))}return[c,r,l,f=>l(f.detail)]}class Ze extends ee{constructor(e){super(),Z(this,e,Ye,Xe,H,{})}}new Ze({target:document.getElementById("app")});
